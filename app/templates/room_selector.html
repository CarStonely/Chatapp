<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Choose a Room</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Favicon -->
  <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link 
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" 
    rel="stylesheet">
  
  <!-- Bootstrap CSS for Spinners and Tooltips -->
  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" 
    rel="stylesheet" 
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoY6b4UKr3oBlb2qz2H3zjE5R1nldoR4o9Bs0R0LqBMU8Y+" 
    crossorigin="anonymous"
  />

  <!-- External CSS -->
  <link rel="stylesheet" href="/static/css/room_selector.css" />
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-brand" onclick="window.location.href='{{ url_for('chat.index') }}'">ChatApp</div>
    <div class="navbar-toggler">&#9776;</div>
    <div class="navbar-menu">
      <span>Logged in as:  <strong>{{ session['username'] }}</strong></span>
      {% if 'user_id' in session %}
        <a href="{{ url_for('auth.profile') }}">Profile</a>
        <a href="{{ url_for('auth.logout') }}">Logout</a>
      {% else %}
        <a href="{{ url_for('auth.login') }}">Login</a>
        <a href="{{ url_for('auth.register') }}">Register</a>
      {% endif %}
      <a href="{{ url_for('chat.index') }}">Room Selector</a>
    </div>
  </nav>

  <!-- Main Container -->
  <div class="container">
    <!-- Header Section -->
    <header class="chat-header">
      <div class="header-content">
        <span class="current-user">Logged in as: <strong>{{ session['username'] }}</strong></span>
        <div class="button-container">
          <!-- Authentication Buttons -->
          {% if 'user_id' in session %}
            <a href="{{ url_for('auth.profile') }}" class="button profile-btn">Profile</a>
            <a href="{{ url_for('auth.logout') }}" class="button logout-btn">Logout</a>
          {% else %}
            <a href="{{ url_for('auth.login') }}" class="button login-btn">Login</a>
            <a href="{{ url_for('auth.register') }}" class="button register-btn">Register</a>
          {% endif %}
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="room-selector-container">
      <h1>Welcome to the Chat Application</h1>
      <!-- Create Room Button -->
      <button id="open-modal-btn" class="button create-room-btn">+ Create Room</button>
      <p>Select a room to join:</p>
      
      <!-- Search and Create Room Container -->
      <div class="search-room-container">
        <input type="text" id="room-search" placeholder="Search rooms..." aria-label="Search rooms">
      </div>

      <!-- Loading Indicator for Room List -->
      <div id="room-list-loading" class="loading-overlay">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading rooms...</span>
        </div>
      </div>

      <!-- Room List -->
      <ul class="room-list" id="room-list">
        {% if rooms %}
          {% for room in rooms %}
            <li>
              <a href="{{ url_for('chat.room', room=room) }}" class="room-link">{{ room }}</a>
            </li>
          {% endfor %}
        {% else %}
          <li>No available rooms. Create one!</li>
        {% endif %}
      </ul>
    </main>

    <!-- Modal for Creating a Room -->
    <div id="create-room-modal" class="modal hidden" aria-hidden="true">
      <div class="modal-content" role="dialog" aria-labelledby="modal-title">
        <span class="close-btn" id="close-modal" aria-label="Close">&times;</span>
        <h2 id="modal-title">Create a New Room</h2>
        <form id="create-room-form" action="{{ url_for('rooms.create_room') }}" method="POST">
          <label for="room">Room Name:</label>
          <input type="text" id="room" name="room" placeholder="Enter room name" required maxlength="50" aria-required="true" aria-label="Room Name">
          <button type="submit" class="button create-room-submit">Create Room</button>
          <!-- Error Message Placeholder -->
          <div id="error-message" class="text-danger mt-2" style="display: none;"></div>
        </form>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <p>&copy; 2024 Chat Application. Built with ❤️ for seamless conversations.</p>
  </footer>

  <!-- Bootstrap JS Bundle (includes Popper for tooltips) -->
  <script 
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+U3zY4AmoF6Ykvh+8t8enY4K+5q6E" 
    crossorigin="anonymous">
  </script>

  <!-- External JavaScript -->
  <script src="/static/js/room_selector.js"></script>
</body>
</html>
